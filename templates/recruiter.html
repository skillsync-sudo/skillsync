<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillSync Pro | Recruiter Dashboard</title>
    <style>
        :root {
            --primary: #4F46E5; 
            --primary-hover: #4338ca; 
            --bg-body: #F3F4F6;
            --bg-card: #FFFFFF; 
            --text-main: #111827; 
            --text-muted: #6B7280;
            --border: #E5E7EB; 
            --radius: 12px; 
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
            --font: 'Inter', system-ui, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: var(--font); 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            line-height: 1.5; 
            padding-top: 80px; 
        }

        .layout { 
                 max-width: 1200px; 
                  margin: 0 auto; 
                  display: grid; 
                  grid-template-columns: 280px 1fr 300px; 
                  gap: 24px; 
                  padding: 0 16px;
                  align-items: start; /* CRITICAL: Allows children to stick independently */
                }   

        header { 
            position: fixed; 
            top: 0; left: 0; right: 0; 
            height: 64px; 
            background: white; 
            border-bottom: 1px solid var(--border); 
            z-index: 1000; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0 24px; 
        }

        .logo { font-weight: 800; font-size: 20px; color: var(--primary); text-decoration: none; }

        .card { 
            background: var(--bg-card); 
            border-radius: var(--radius); 
            border: 1px solid var(--border); 
            box-shadow: var(--shadow-sm); 
            margin-bottom: 20px; 
            padding: 20px; 
        }

        .btn { padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }

        .avatar-sm { 
            width: 40px; height: 40px; border-radius: 50%; 
            background: #E0E7FF; color: var(--primary); 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; overflow: hidden;
        }
        .avatar-sm img { width: 100%; height: 100%; object-fit: cover; }

        .post-header { display: flex; gap: 12px; margin-bottom: 12px; }
        .post-actions { 
            display: flex; gap: 15px; border-top: 1px solid var(--border); 
            padding-top: 12px; margin-top: 12px; 
        }
        .action-btn { 
            background: none; border: none; color: var(--text-muted); 
            cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; text-decoration: none;
        }
        .action-btn:hover { color: var(--primary); }

        .comments-section { background: #F9FAFB; padding: 12px; border-radius: 8px; margin-top: 10px; display: none; }
        
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 2000;
            align-items: center; justify-content: center;
        }
        .modal-card {
            background: white; width: 95%; max-width: 450px; padding: 24px;
            border-radius: 16px; position: relative;
        }

        @media (max-width: 900px) { 
            .layout { grid-template-columns: 1fr; } 
            .left-sidebar, .right-sidebar { display: none; } 
        }
        .left-sidebar, .right-sidebar {
                                         position: sticky;
                                         top: 84px; /* header height (64px) + 20px gap */
                                         height: fit-content;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">SkillSync</div>

    <div class="search-container" style="flex-grow: 1; max-width: 400px; margin: 0 20px; position: relative;">
        <div style="display: flex; align-items: center; background: #f3f6f8; border-radius: 8px; padding: 5px 15px;">
            <span style="color: #666;">üîç</span>
            <input type="text" id="live-search" name="query" placeholder="Search internships or people..." 
                   style="border: none; background: transparent; padding: 8px; width: 100%; outline: none;" autocomplete="off">
            
            <select id="search-type" name="type" style="border: none; background: transparent; color: #666; font-size: 12px; cursor: pointer;">
                <option value="all">All</option>
                <option value="internships">Internships</option>
                <option value="people">People</option>
            </select>
        </div>
        <div id="search-results-popup" style="display:none; position:absolute; width:100%; background:white; border:1px solid #ddd; border-radius:8px; z-index:1000; box-shadow:0 8px 24px rgba(0,0,0,0.1); margin-top: 5px; overflow: hidden;"></div>
    </div>

    <div style="display: flex; gap: 10px; margin-right: 15px;">
        <div class="icon-btn" title="Intern" style="cursor: pointer; font-size: 18px;">üßëüèª</div>
        <div class="icon-btn" onclick="toggleNotifDropdown(event)" style="position: relative; cursor: pointer;">
    üîî
    {% if unread_count > 0 %}
        <span id="notif-badge" style="position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; font-size: 10px; padding: 2px 6px; border-radius: 50%; font-weight: bold; border: 2px solid white;">
            {{ unread_count }}
        </span>
    {% endif %}

    <div id="notifDropdown" style="display: none; position: absolute; top: 45px; right: 0; width: 300px; background: white; border: 1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow-md); z-index: 9999; text-align: left;">
        <div style="padding: 12px; font-weight: bold; border-bottom: 1px solid #eee;">Notifications</div>
        <div style="max-height: 350px; overflow-y: auto;">
            {% for n in notifications %}
                <div style="padding: 12px; border-bottom: 1px solid #f9f9f9; font-size: 13px; {% if not n.is_read %}background: #f0f7ff;{% endif %}">
                    <strong>{{ n.sender_name }}</strong> {{ n.message }}
                    <div style="font-size: 11px; color: #999; margin-top: 4px;">{{ n.date_created.strftime('%H:%M') }}</div>
                </div>
            {% else %}
                <div style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 13px;">No new alerts</div>
            {% endfor %}
        </div>
    </div>
</div>
    </div>

    <div class="profile-container" style="position: relative;">
        <div id="profileTrigger" style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
            <img src="{% if user.profile_pic %}{{ url_for('static', filename='uploads/' + user.profile_pic) }}{% else %}https://ui-avatars.com/api/?name={{ user_name }}{% endif %}" 
                 alt="Profile" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
            <span>{{ user_name }}</span>
        </div>

        <div id="profileDropdown" style="display:none; position:absolute; right:0; top:48px; background:white; box-shadow:0 8px 24px rgba(0,0,0,0.15); border-radius:10px; width:220px; z-index:99; padding:10px; border: 1px solid #eee;">
            <div style="padding:10px; border-bottom: 1px solid #eee; margin-bottom: 5px;">
                <small style="color: #666; display: block;">Signed in as</small>
                <strong>{{ user_name }}</strong>
            </div>
            <div class="dropdown-item" style="padding:8px 6px; border-radius:8px; cursor:pointer;" id="viewProfileBtn">üë§ View Profile</div>
            <div class="dropdown-item" id="editProfileBtn" style="padding:8px 6px; border-radius:8px; cursor:pointer;">‚öôÔ∏è Edit Profile</div>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 8px 0;">
            <div style="padding: 5px;">
                <a href="{{ url_for('logout') }}" style="display: block; width: 100%; padding: 8px; border-radius: 8px; color: #dc3545; text-align: center; border: 1px solid #dc3545; text-decoration: none; font-weight: bold;">Logout</a>
            </div>
        </div>
    </div>
</header>
<div class="layout">
   <aside class="left-sidebar">
    <div class="card" style="text-align: center; position: sticky; top: 80px;">
        <div class="avatar-sm" style="width: 100px; height: 100px; margin: 0 auto 15px; font-size: 40px; border: 3px solid var(--primary);">
            {% if user.profile_pic and user.profile_pic != 'default.png' %}
                <img src="{{ url_for('static', filename='uploads/' + user.profile_pic) }}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--bg-body); color: var(--primary);">
                    {{ user.name[0] if user.name else '?' }}
                </div>
            {% endif %}
        </div>

        <h3 style="margin-bottom: 5px;">{{ user.name }}</h3>
        <p style="color: var(--primary); font-size: 14px; font-weight: 600; margin-bottom: 2px;">
            Recruiter
        </p>
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 10px;">
            {{ user.company_name or 'Independent' }}
        </p>
        
        <div style="margin-bottom: 15px;">
            {% if user.is_verified %}
                <span style="color: #10b981; font-size: 11px; font-weight: bold; background: #ecfdf5; padding: 4px 8px; border-radius: 20px;">‚úÖ VERIFIED PARTNER</span>
            {% else %}
                <span style="color: #ef4444; font-size: 11px; font-weight: bold; background: #fef2f2; padding: 4px 8px; border-radius: 20px;">‚è≥ UNVERIFIED</span>
            {% endif %}
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border); margin: 15px 0;">

        <div style="text-align: left; margin-bottom: 15px;">
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">
                <strong>üìß Email:</strong><br>
                <span style="color: var(--text-main);">{{ user.email }}</span>
            </p>
            
            {% if user.phone %}
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">
                <strong>üìû Phone:</strong><br>
                <span style="color: var(--text-main);">{{ user.phone }}</span>
            </p>
            {% endif %}

            {% if user.website %}
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">
                <strong>üåê Website:</strong><br>
                <a href="{{ user.website }}" target="_blank" style="color: var(--primary); text-decoration: none;">{{ user.website|replace('https://','')|replace('http://','') }}</a>
            </p>
            {% endif %}
        </div>

        <div style="display: flex; justify-content: center; gap: 15px; margin: 20px 0; font-size: 24px;">
    {% if user.facebook %}
        <a href="{{ user.facebook }}" target="_blank" title="Facebook" style="text-decoration: none;">üë§</a>
    {% endif %}

    {% if user.twitter %}
        <a href="{{ user.twitter }}" target="_blank" title="Twitter" style="text-decoration: none;">üê¶</a>
    {% endif %}

</div>

        <button onclick="openEditModal()" class="btn btn-primary" style="width: 100%;">‚öôÔ∏è Edit Profile</button>
    </div>
</aside>
    <main class="main-content">
        <div class="card">
            <form action="{{ url_for('create_post') }}" method="POST">
                <textarea name="content" placeholder="Post a new internship or update..." style="width: 100%; border: none; outline: none; font-size: 16px; resize: none; min-height: 80px;" required></textarea>
                <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 10px;">
               {% if session['role'] == 'recruiter' %}
                    <label style="font-size: 13px; color: var(--text-muted);">
                        <input type="checkbox" name="can_apply"> Enable Internship Apply Button
                    </label>
                {% else %}
                    <div></div>
                {% endif %}
                    <button type="submit" class="btn btn-primary">Post</button>
                </div>
            </form>
        </div>

        <div id="posts-feed">
            {% for post in posts %}
            <div class="card">
                <div class="post-header">
                    <div class="avatar-sm" onclick="openProfileDetail('{{ post.author_id }}', '{{ post.author_role }}')" style="cursor:pointer;">
                        {% set author = Student.query.get(post.author_id) if post.author_role == 'student' else Recruiter.query.get(post.author_id) %}
                        {% if author and author.profile_pic %}<img src="{{ url_for('static', filename='uploads/' + author.profile_pic) }}">{% else %}{{ post.author_name[0] }}{% endif %}
                    </div>
                    <div>
                        <strong onclick="openProfileDetail('{{ post.author_id }}', '{{ post.author_role }}')" style="cursor:pointer;">{{ post.author_name }}</strong>
                        <div style="font-size: 12px; color: var(--text-muted);">{{ post.author_role|capitalize }} ‚Ä¢ {{ post.date_posted.strftime('%H:%M') }}</div>
                    </div>
                </div>

                <div class="post-content">{{ post.content }}</div>

                <div class="post-actions">
                    <a href="{{ url_for('like_post', post_id=post.id) }}" class="action-btn">‚ù§Ô∏è {{ post.likes_count }}</a>
                    <button class="action-btn" onclick="toggleComments({{ post.id }})">üí¨ Comment</button>
                    {% if session['user_id'] == post.author_id and session['role'] == post.author_role %}
                    <div style="margin-left: auto; display: flex; gap: 12px;">
                        <button onclick="editPost({{ post.id }}, '{{ post.content }}')" class="action-btn" style="color: var(--primary);">‚úèÔ∏è Edit</button>
                        <a href="{{ url_for('delete_post', post_id=post.id) }}" class="action-btn" style="color: #dc3545;" onclick="return confirm('Delete post?')">üóëÔ∏è Delete</a>
                    </div>
                    {% endif %}
                </div>

                <div id="comments-{{ post.id }}" class="comments-section">
                    {% for comment in post.comments %}
                        <div style="font-size: 13px; margin-bottom: 5px;">
                            <strong>{{ comment.author_name }}:</strong> {{ comment.text }}
                        </div>
                    {% endfor %}
                    <form action="{{ url_for('add_comment', post_id=post.id) }}" method="POST" style="display:flex; gap:5px; margin-top:10px;">
                        <input type="text" name="comment_text" placeholder="Write a comment..." style="flex:1; padding:5px; border:1px solid #ddd; border-radius:5px;" required>
                        <button type="submit" class="btn btn-primary" style="padding:2px 10px;">Send</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <aside class="right-sidebar">
        <div class="card">
            <h4>Suggested for you</h4>
            <p style="font-size: 13px; color: var(--text-muted); margin-top: 10px;">No new suggestions today.</p>
        </div>
    </aside>
</div>
<div id="editProfileModal" class="modal-overlay">
    <div class="modal-card" style="max-width: 500px;">
        <button onclick="closeModal()" style="position:absolute; right:16px; top:16px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
        
        <h2 style="margin-bottom: 20px;">Professional Profile</h2>
        
        <form action="{{ url_for('edit_recruiter_profile') }}" method="POST" enctype="multipart/form-data">
          <div style="text-align: center; margin-bottom: 20px;">
    <div style="position: relative; display: inline-block;">
        <img id="preview-img" 
             src="{{ url_for('static', filename='uploads/' + user.profile_pic) if user.profile_pic else 'https://ui-avatars.com/api/?name=' + user.name }}" 
             style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary);">
        
        <label for="profile_pic_input" style="position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; padding: 6px; border-radius: 50%; cursor: pointer; font-size: 14px; line-height: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            üì∏
        </label>
    </div>
    <input type="file" id="profile_pic_input" name="profile_pic" style="display: none;" accept="image/*" onchange="previewImage(this)">
    <p style="font-size: 11px; color: var(--text-muted); margin-top: 5px;">Click icon to change photo</p>
</div>

            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="font-size: 12px; font-weight: 600;">Full Name</label>
                    <input type="text" name="name" value="{{ user.name }}" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                </div>
                <div style="flex: 1;">
                    <label style="font-size: 12px; font-weight: 600;">Company / Org</label>
                    <input type="text" name="company" value="{{ user.company_name or '' }}" placeholder="SkillSync Inc." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                   <label style="font-size: 12px; font-weight: 600;">Position</label>
                  <input type="text" name="position" value="{{ user.position or '' }}" placeholder="SkillSync Inc." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">

                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="font-size: 12px; font-weight: 600;">Telephone</label>
                    <input type="text" name="phone" value="{{ user.phone or '' }}" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                </div>
                <div style="flex: 1;">
                    <label style="font-size: 12px; font-weight: 600;">Website Link</label>
                    <input type="url" name="website" value="{{ user.website or '' }}" placeholder="https://yoursite.com" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-size: 12px; font-weight: 600;">Social Media Pages</label>
                <div style="display: flex; gap: 10px; margin-top: 5px;">
                    <input type="text" name="facebook" value="{{ user.facebook or '' }}" placeholder="Facebook link" style="flex:1; padding:8px; border:1px solid #ddd; border-radius:6px;">
                    <input type="text" name="twitter" value="{{ user.twitter or '' }}" placeholder="Twitter/X link" style="flex:1; padding:8px; border:1px solid #ddd; border-radius:6px;">
                </div>
            </div>

            <div style="margin-bottom: 20px; padding: 12px; background: #f3f6f8; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">
                <span style="font-size: 13px; font-weight: 600;">Account Status:</span>
                {% if user.is_verified %}
                    <span style="color: #10b981; font-weight: bold; font-size: 13px;">‚úÖ VERIFIED</span>
                {% else %}
                    <span style="color: #ef4444; font-weight: bold; font-size: 13px;">‚è≥ UNVERIFIED</span>
                {% endif %}
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">Save Professional Details</button>
        </form>
    </div>
</div>

<form id="global-edit-form" method="POST" style="display:none;">
    <input type="hidden" name="new_content" id="global-edit-input">
</form>
<div id="profileDetailModal" class="modal-overlay" style="display:none;">
    <div class="modal-card" style="text-align: center; max-width: 400px; padding: 30px;">
        <button onclick="closeProfileDetail()" style="position:absolute; right:16px; top:16px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
        
        <div id="popup-avatar" class="avatar-sm" style="width: 90px; height: 90px; margin: 0 auto 15px; font-size: 32px; border: 2px solid var(--primary);"></div>
        <h2 id="popup-name" style="margin-bottom: 5px;"></h2>
        <p id="popup-role-label" style="color: var(--primary); font-weight: bold; font-size: 12px; margin-bottom: 15px; text-transform: uppercase;"></p>
        
        <div style="text-align: left; border-top: 1px solid #eee; padding-top: 15px;">
            <div id="student-content" style="display:none;">
                <p style="margin-bottom: 8px;"><strong>üéì Education:</strong> <span id="popup-education"></span></p>
                <div>
                    <strong>üõ†Ô∏è Skills:</strong>
                    <div id="popup-skills-list" style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;"></div>
                </div>
            </div>

            <div id="recruiter-content" style="display:none;">
                 <p style="margin-bottom: 8px;"><strong> Company_Name:</strong> <span id="popup-company"></span></p>
                <p style="margin-bottom: 8px;"><strong> Position:</strong> <span id="popup-position"></span></p>

                <p style="margin-bottom: 8px;"><strong>‚úÖ Status:</strong> <span id="popup-status"></span></p>
                 <div id="popup-socials-container" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                         <strong style="font-size: 12px; color: #666; display: block; margin-bottom: 8px;">CONNECT:</strong>
                     <div id="popup-socials" style="display: flex; gap: 15px; font-size: 20px;">
            </div>
            </div>
        </div>

        <div style="margin-top: 25px;">
            <a id="msg-btn" href="#" class="btn btn-primary" style="display: block; width: 100%; text-decoration: none; margin-bottom: 10px;">
                Send Message
            </a>
            <button onclick="closeProfileDetail()" class="btn" style="width: 100%; background: #eee;">Close</button>
        </div>
    </div>
</div>
<script>
    // --- 1. DROPDOWN HANDLERS (Profile & Notifications) ---
    const profileTrigger = document.getElementById('profileTrigger');
    const profileDropdown = document.getElementById('profileDropdown');
    const notifDropdown = document.getElementById('notifDropdown');

    // Toggle Profile Menu
    profileTrigger.addEventListener('click', (e) => {
        e.stopPropagation();
        const isVisible = profileDropdown.style.display === 'block';
        profileDropdown.style.display = isVisible ? 'none' : 'block';
        if (notifDropdown) notifDropdown.style.display = 'none';
    });

    // Toggle Notifications
    async function toggleNotifDropdown(event) {
        event.stopPropagation();
        const isVisible = notifDropdown.style.display === 'block';
        notifDropdown.style.display = isVisible ? 'none' : 'block';
        profileDropdown.style.display = 'none';
        
        // Clear red badge if opening
        const badge = document.getElementById('notif-badge');
        if (!isVisible && badge) {
            badge.style.display = 'none';
            await fetch('/clear-notifications');
        }
    }

    // Close everything when clicking anywhere else
    window.addEventListener('click', (e) => {
        if (!profileDropdown.contains(e.target)) profileDropdown.style.display = 'none';
        if (notifDropdown && !notifDropdown.contains(e.target)) notifDropdown.style.display = 'none';
    });

    // --- 2. MODAL CONTROLS (Edit Profile & View Detail) ---
    
    // Open Edit Profile Modal
    document.getElementById('editProfileBtn').addEventListener('click', openEditModal);
    
    function openEditModal() {
        document.getElementById('editProfileModal').style.display = 'flex';
        profileDropdown.style.display = 'none'; // Close dropdown
    }

    function closeModal() {
        document.getElementById('editProfileModal').style.display = 'none';
    }

    function closeProfileDetail() {
        document.getElementById('profileDetailModal').style.display = 'none';
    }

    // --- 3. SEARCH & PROFILE POPUP LOGIC ---
    const searchInput = document.getElementById('live-search');
    const resultsPopup = document.getElementById('search-results-popup');

    searchInput.addEventListener('input', async () => {
        const query = searchInput.value;
        if (query.length < 2) { 
            resultsPopup.style.display = 'none'; 
            return; 
        }
        try {
            const res = await fetch(`/api/search?query=${query}&type=people`);
            const data = await res.json();
            resultsPopup.innerHTML = data.people.map(p => `
                <div style="padding:12px; border-bottom:1px solid #eee; cursor:pointer;" 
                     onclick="openProfileDetail('${p.id}', '${p.role}')">
                    <div style="font-weight:600;">üë§ ${p.name}</div>
                    <div style="font-size:11px; color:#666;">${p.role.toUpperCase()}</div>
                </div>
            `).join('');
            resultsPopup.style.display = 'block';
        } catch (err) { console.error("Search Error:", err); }
    });

    // Function to fetch and show User Details in the popup
   async function openProfileDetail(userId, role) {
    try {
        const response = await fetch(`/api/user-details/${role}/${userId}`);
        const data = await response.json();
        if (data.error) return;

        const stdDiv = document.getElementById('student-content');
        const recDiv = document.getElementById('recruiter-content');
        const msgBtn = document.getElementById('msg-btn');
        
        document.getElementById('popup-name').innerText = data.name;
        document.getElementById('popup-role-label').innerText = role;

        if (role === 'student') {
            stdDiv.style.display = 'block';
            recDiv.style.display = 'none';
            document.getElementById('popup-education').innerText = data.education;
            msgBtn.innerText = "üí¨ WhatsApp";
            msgBtn.href = `https://wa.me/${data.whatsapp.replace(/\D/g,'')}`;
        } 
        else {
            stdDiv.style.display = 'none';
            recDiv.style.display = 'block';
            document.getElementById('popup-company').innerText = data.company_name;
            document.getElementById('popup-status').innerText = data.status;
            document.getElementById('popup-position').innerText =data.position;

            // Handle Social Links
            const socialsDiv = document.getElementById('popup-socials');
            socialsDiv.innerHTML = ''; // Clear previous
            
            if (data.facebook) socialsDiv.innerHTML += `<a href="${data.facebook}" target="_blank" title="Facebook" style="text-decoration:none;">üë§</a>`;
            if (data.twitter) socialsDiv.innerHTML += `<a href="${data.twitter}" target="_blank" title="Twitter" style="text-decoration:none;">üê¶</a>`;
            if (data.website) socialsDiv.innerHTML += `<a href="${data.website}" target="_blank" title="Website" style="text-decoration:none;">üåê</a>`;
            
            if (socialsDiv.innerHTML === '') {
                document.getElementById('popup-socials-container').style.display = 'none';
            } else {
                document.getElementById('popup-socials-container').style.display = 'block';
            }

            msgBtn.innerText = "üìß Send Email";
            msgBtn.href = `mailto:${data.email}`;
        }

        // Avatar logic
        const avatar = document.getElementById('popup-avatar');
        avatar.innerHTML = data.profile_pic && data.profile_pic !== 'default.png' 
            ? `<img src="/static/uploads/${data.profile_pic}" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`
            : data.name[0];

        document.getElementById('profileDetailModal').style.display = 'flex';
    } catch (err) { console.error(err); }
}

    // --- 4. FEED ACTIONS ---
    function toggleComments(id) {
        const el = document.getElementById(`comments-${id}`);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    function editPost(id, content) {
        const newText = prompt("Edit your post:", content);
        if (newText && newText.trim() !== "") {
            const form = document.getElementById('global-edit-form');
            form.action = `/edit-post/${id}`;
            document.getElementById('global-edit-input').value = newText;
            form.submit();
        }
    }

    // Image Preview for Profile Upload
   function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // Updates the src of the #preview-img shown above
            document.getElementById('preview-img').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}
</script>

</body>
</html>